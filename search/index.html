<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Search - Results</title>
    <link rel="icon" type="image/x-icon" href="/FreeSearchIcon.png">
    <meta name="theme-color" content="#f0f2f5" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://pooiod7.neocities.org/snips/GenerativeAI.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #ffffff;
            display: flex;
            /* justify-content: space-between; */
            padding: 10px 20px;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        #search-bar {
            display: flex;
            align-items: center;
            width: 80%;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ccc;
            outline: none;
            font-size: 16px;
            autocomplete: "off";
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            margin-left: 10px;
            border-radius: 10px;
            cursor: pointer;
        }
        #icon {
            background: none;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }
        .results-container {
            padding: 0;
            max-width: 900px;
            margin: 0 auto;
        }
        .search-type-tabs {
            display: flex;
            margin-top: 3px;
            margin-bottom: 10px;
            padding: 10px 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        .search-type-tabs button {
            background-color: #e8f0fe;
            border: 1px solid #d3d3d3;
            color: #1a0dab;
            padding: 8px 12px;
            margin-right: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .search-type-tabs .noclickbutton {
            background-color: #e8f0fe;
            border: 1px solid #d3d3d3;
            color: #000000;
            cursor: default;
        }
        .search-type-tabs button.show {
            opacity: 1;
            transform: translateY(0);
        }
        .quick-answer {
            background-color: #f9f9f9;
            border: 1px solid #d3d3d3;
            border-radius: 4px;
            padding: 10px;
            font-size: 16px;
            color: #333;
            margin: 0 20px;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .card {
            background-color: white;
            border-radius: 4px 8px 8px 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin: 15px 20px;
            padding: 15px;
            border-left: 4px solid #1a73e8;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .card.show {
            opacity: 1;
            transform: translateY(0);
        }
        .card h3 {
            margin: 0;
            font-size: 18px;
            color: #1a0dab;
        }
        .card p {
            font-size: 14px;
            color: #4d5156;
        }
        .card a {
            color: #1a0dab;
            text-decoration: none;
            font-size: 14px;
        }
        .card a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

<header id="header">
    <button id="icon" onclick="window.location.href='/'">
        <img src="/FreeSearchIcon.png" alt="Home" width="30px">
    </button>
    <div id="search-bar">
        <input type="text" id="search-input" placeholder="Search..." autocomplete="off">
        <button onclick="redirectToSearch()">Search</button>
    </div>
</header>

<div id="loader" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; transition: opacity 0.3s ease; opacity: 0;">
    <div style="border: 4px solid rgba(0, 0, 0, 0.1); border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 0.7s linear infinite;"></div>
</div>
<style>
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>

<div class="search-type-tabs" id="search-tabs">
    <button class="noclickbutton">Try searching other platforms</button>
</div>

<div class="results-container">
    <div id="quick-answer" class="quick-answer" style="display: none;"></div>
    <div id="results"></div>
</div>

<script>
    let cardIndex = 1;

    var buttonsJson = [
        { 
            name: "Google", link: "https://google.com/search?q=%s", 
            regex: null,
            tags: [],
            alwaysShow: true
        },
        { 
            name: "Scratch", link: "https://scratch.mit.edu/search/projects?q=%s", 
            regex: /(\bin scratch\b|\bon scratch\b)/gi,
            tags: [
                "scratch",
                "project",
                "coding"
            ],
            alwaysShow: false
        }
    ];

    function getQueryParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
    }

    function performSearch(query) {
        document.getElementById("loader").style.opacity = 1;

        search(query).then(results => {
            document.getElementById("loader").style.opacity = 0;

            results.forEach(result => {
                addCard(result.title, result.description, result.url, result.url);
            });

            if (results.length == 0) {
                displayQuickAnswer(`No results found`);
            } else if (query.endsWith("?")) {
                displayQuickAnswer(`Loading quick answer...`, true);
                gpt.int(`Your job is to do nothing but take the search results you are given, and give an answer to the question rovided by the user. You may not list your name, or that you are a bot, just answer based on the results. Keep it short and simple. Also, use html formatting for your text, not mardown.`, "gpt-4o");
                gpt.inform("Search results: " + JSON.stringify(results));
                gpt.prompt(query).then(displayQuickAnswer);
            }
        });
    }

    function displayQuickAnswer(answer, basic) {
        const quickAnswerDiv = document.getElementById('quick-answer');
        quickAnswerDiv.style.display = 'block';
        quickAnswerDiv.style.opacity = '1';
        quickAnswerDiv.style.transform = 'translateY(0)';
        quickAnswerDiv.innerHTML = `${!basic?"<strong>Quick Answer:</strong> ":""}${answer}`;
    }

    function addCard(title, description, link, fullurl) {
        const resultsDiv = document.getElementById('results');
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<h3><a href="${fullurl}">${title}</a></h3><p>${description}</p><a href="${fullurl}">${link}</a>`;
        resultsDiv.appendChild(card);
        setTimeout(() => {
            card.classList.add('show'); // Animate card entry
        }, cardIndex * 50); // Delay each card by 50ms
        cardIndex++;
    }

    function redirectToSearch() {
        openURL(`?q=${encodeURIComponent(document.getElementById('search-input').value.trim())}`);
    }

    function openURL(url) {
        const header = document.getElementById('header');
        header.style.opacity = '0';
        header.style.transform = 'translateY(-100)';

        setTimeout(() => {
            header.style.opacity = '1';
            header.style.transform = 'translateY(0)';
        }, 500);

        const quickAnswerDiv = document.getElementById('quick-answer');
        quickAnswerDiv.style.opacity = '0';
        quickAnswerDiv.style.transform = 'translateY(-100)';

        setTimeout(() => {
            quickAnswerDiv.style.opacity = '1';
            quickAnswerDiv.style.transform = 'translateY(0)';
        }, 500);

        const tabs = document.querySelectorAll('.show');
        tabs.forEach((tab, index) => {
            setTimeout(() => {
                tab.classList.remove('show');

                setTimeout(() => {
                    tab.classList.add('show');
                }, (index * 50) + 500);
            }, index * 50);
        });

        setTimeout(() => {
            window.location.href = url;
        }, 300);
    }

    function animateHeaderAndTabs(query) {
        const header = document.getElementById('header');
        header.style.opacity = '1';
        header.style.transform = 'translateY(0)';

        const searchTabs = document.getElementById("search-tabs");
        const queryWords = query.split(" ");

        buttonsJson.forEach(button => {
            const matches = button.tags.some(tag => queryWords.includes(tag));
            if (matches || button.alwaysShow) {
                const buttonElement = document.createElement("button");
                buttonElement.textContent = button.name;
                buttonElement.onclick = () => {
                    window.location.href = button.link.replace("%s", encodeURIComponent(button.regex?(query.replace(button.regex, '').trim()):query));
                };
                searchTabs.appendChild(buttonElement);
            }
            if (matches.length == 0) {
                searchTabs.display = "none";
            }
        });

        const tabs = document.querySelectorAll('.search-type-tabs button');
        tabs.forEach((tab, index) => {
            setTimeout(() => {
                tab.classList.add('show');
            }, index * 50); // Delay each tab by 50ms
        });
    }

    window.onload = () => {
        const query = getQueryParameter('q');
        document.getElementById('search-input').value = query || '';

        if (!query) {
            window.location.href = '/';
            return;
        }

        animateHeaderAndTabs(document.getElementById('search-input').value);

        setTimeout(function(){
            performSearch(query);
        }, 300);

        document.getElementById('search-input').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                redirectToSearch();
            }
        });
    };

    async function search(query) {
        const searchUrl = `https://test.cors.workers.dev/?${encodeURIComponent("http://frogfind.com/?q=" + query)}`;

        try {
            const response = await fetch(searchUrl);
            if (!response.ok) {
                throw new Error(`Failed to fetch search results: ${response.status}`);
            }

            const text = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(text, "text/html");

            const links = Array.from(doc.querySelectorAll('a')).map(link => {
                const titleElement = link.querySelector('font[size="4"]');
                const title = titleElement ? titleElement.textContent : '';
                const url = link.getAttribute('href')?.replace('/read.php?a=', '') || '';
                return { title, url };
            }).filter(link => link.url);

            const results = await Promise.all(links.map(async link => {
                if (!link.url) return null;

                try {
                    const metaResponse = await fetch("https://test.cors.workers.dev/?"+encodeURIComponent(`https://api.dub.co/metatags?url=${encodeURIComponent(link.url)}`));
                    if (!metaResponse.ok) {
                        console.warn(`Meta fetch failed for ${link.url}: ${metaResponse.status}`);
                        return null;
                    }

                    const metaData = await metaResponse.json();
                    return {
                        title: link.title,
                        url: link.url,
                        description: metaData.description || '',
                        image: metaData.image || '',
                        poweredBy: metaData.poweredBy || ''
                    };
                } catch (metaError) {
                    console.error(`Error fetching meta data for ${link.url}: ${metaError}`);
                    return null;
                }
            }));

            return results.filter(result => result); // Filter out null results
        } catch (error) {
            console.error('Error fetching search results:', error);
            return [];
        }
    }
</script>

</body>
</html>
